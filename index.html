<!DOCTYPE html>
<html>
<head>
  <title>Mapping Montana's politics</title>
  <link rel="stylesheet" type="text/css" href="./../css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="./../css/main.css">
</head>
<body>
  <div id="chart1"></div>
  <div id="viz-container">
    <div id="chart1"></div>
    <div id="chart2"></div>
    <div id="chart3"></div>
    <div id="chart4"></div>
  </div>

  <script src="js/d3.min.js"></script>

  <script src="js/data-wrangling.js"></script>
  <script src="js/globals.js"></script>
  <script src="js/Dashboard.js"></script>
  <script src="js/Panel.js"></script>

  <script src="js/Choropleth.js"></script>
  <script src="js/CircleShadeMap.js"></script>
  <script src="js/BarGraph.js"></script>
  <script src="js/OpposingBarGraph.js"></script>
  <script src="js/DistrictArray.js"></script>
  <script src="js/Cartogram.js"></script>
  <script src="js/ColorMap.js"></script>
  <script type="text/javascript">

  var dataFiles = [
    // Array of files for Dashboard to pull in
    // Geodata
    {'name': 'mtSenDistricts', 'file': './../geodata/mt_senate_districts.geojson', 'loader': d3.json},
    {'name': 'mtHouseDistricts', 'file': './../geodata/mt_house_districts.geojson', 'loader': d3.json},
    // Other data
    {'name': 'mtSenData', 'file': './../data/mt-senate.csv', 'loader': d3.csv},
    {'name': 'mtHouseData', 'file': './../data/mt-house.csv', 'loader': d3.csv},
  ];
  var dataJoins = [
    // Array of data processing functions for Dashboard to run on data refresh
    // TODO: Figure out how to make this more concise?
    {
      'name': 'comboSenDistricts',
      'functName': bindToGeoJson,
      'geoData': 'mtSenDistricts', 'joinData': 'mtSenData',
      'geoKey': 'number', 'joinKey': 'number',
      'includeCols': ['district', 'incum_party', 'district_label']
    },{
      'name': 'comboHouseDistricts',
      'functName': bindToGeoJson,
      'geoData': 'mtHouseDistricts', 'joinData': 'mtHouseData',
      'geoKey': 'number', 'joinKey': 'number',
      'includeCols': ['district', 'incum_party', 'district_label']
    }
  ];
  var initialPanel = {
    'name': 'panel1',
    'design': [
      {'id': 'chart1', 'Template': ColorMap, 'data': 'comboSenDistricts' },
      {'id': 'chart2', 'Template': ColorMap, 'data': 'comboHouseDistricts' }
    ]
  };
  var dashboard = new Dashboard(dataFiles, dataJoins, initialPanel);

    // // Queue up multiple data files to load
    // d3.queue()
    //   // Geodata
    //   .defer(d3.json, './../geodata/mt_counties.geojson')
    //   .defer(d3.json, './../geodata/gc_precincts.geojson')
    //   .defer(d3.json, './../geodata/mt_senate_districts.geojson')
    //   .defer(d3.json, './../geodata/mt_house_districts.geojson')
    //   .defer(d3.json, './../geodata/sen-carto.geojson')
    //   // Other data
    //   .defer(d3.json, './../data/2012_election_county_data.json')
    //   .defer(d3.json, './../data/fake_election_precincts.json')
    //   .defer(d3.json, './../data/districts.json')
    //   .defer(d3.csv, './../data/mt-senate.csv')
    //   .defer(d3.csv, './../data/mt-house.csv')
    //   .await(main);

    function main (error,
      // Geodata
      counties, gcPrecincts, mtSenDistricts, mtHouseDistricts, mtSenCartoDisplay,
      // Other data
      countyVotes, precinctVotes, districts, mtSenData, mtHouseData
      ) {

      // var comboData = bindToGeoJson(mtSenDistricts, mtSenData, 'number', 'number', ['district', 'incum_party', 'district_label']);
      // var comboData2 = bindToGeoJson(mtHouseDistricts, mtHouseData, 'number', 'number', ['district', 'incum_party', 'district_label']);
      // Panel(
      //   [
      //     {'id': 'senateMap', 'Template': ColorMap, 'data': comboData },
      //     {'id': 'senateMap2', 'Template': ColorMap, 'data': comboData2 }
      //   ]
      // );

      // var cartogram = new ColorMap({
      //   'element': document.querySelector('#chart1'),
      //   'data': bindToGeoJson(mtSenCartoDisplay, mtSenData, 'sd', 'number',
      //       ['district', 'incum_party', 'district_label']),
      //   'aspectRatio': .6, // h / w
      // });

      // var senateMap = new ColorMap({
      //   'element': document.querySelector('#chart1'),
      //   'data': bindToGeoJson(mtSenDistricts, mtSenData, 'number', 'number',
      //       ['district', 'incum_party', 'district_label']),
      //   'aspectRatio': .6
      // })

      // var houseMap = new ColorMap({
      //   'element': document.querySelector('#chart3'),
      //   'data': bindToGeoJson(mtHouseDistricts, mtHouseData, 'number', 'number',
      //       ['district', 'incum_party', 'district_label']),
      //   'aspectRatio': .6
      // })

      // var districts = new DistrictArray({
      //   'element': document.querySelector('#chart4'),
      //   'data': districts,
      //   'height': 1500
      // });

      // var countyBar = new BarGraph({
      //   'element': document.querySelector('#chart1'),
      //   'data': prepForBar(countyVotes, 'reg_voters', ['tester_votes', 'rehberg_votes','cox_votes']),
      //   'height': 100
      // })
      // var countyOpposing = new OpposingBarGraph({
      //   'element': document.querySelector('#chart2'),
      //   'data': prepForBar(countyVotes, 'reg_voters', ['tester_votes', 'rehberg_votes','cox_votes']),
      //   'height': 100
      // })

      // var countiesMerged = mergeData(counties, countyVotes, 'NAME', {
      //   'voters': 'reg_voters',
      //   'votesCast': 'votes_cast',
      //   'toPlot': 'tester_votes'
      // });
      // var countyMap = new Choropleth({
      //     'element': document.querySelector('#chart3'),
      //     'data': countiesMerged,
      //     'height': 400
      //   });

      // var precinctsMerged = mergeData(gcPrecincts, precinctVotes, 'PRECINCT', {
      //   'voters': 'VOTERS',
      //   'votesCast': 'VOTERS',
      //   'toPlot': 'A_VOTES'
      // })
      // var gcPrecinctsMap = new Choropleth({
      //     'element': document.querySelector('#chart2'),
      //     'data': precinctsMerged,
      //     'height': 400
      //   });

      // OLD -------
      // var map = new CircleShadeMap({
      //     'element': '#circleshade',
      //     'data': {
      //       'districts': counties,
      //       'votes': countyVotes
      //     },
      //     'width': 500,
      //     'height': 400
      //   }, globals);

      // For resizing
      d3.select(window).on('resize', function(){
      })
    }
  </script>
</html>