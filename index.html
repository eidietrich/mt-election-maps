<!DOCTYPE html>
<html>
<head>
  <title>Mapping Montana's politics</title>
  <link rel="stylesheet" type="text/css" href="./../css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="./../css/main.css">
</head>
<body>
  <ul class="nav nav-tabs"">
    <li role="presentation" id="mtGov" onclick="handleTabClick(this);" class="active"><a href="#">MT Gov</a></li>
    <li role="presentation" id="usHouse" onclick="handleTabClick(this);"><a href="#">US House Seat</a></li>
    <li role="presentation" id="usPresident" onclick="handleTabClick(this);"><a href="#">US Presidency</a></li>
    <li role="presentation" id="mtSenate" onclick="handleTabClick(this);"><a href="#">Montana Senate</a></li>
    <li role="presentation" id="mtHouse" onclick="handleTabClick(this);"><a href="#">Montana House</a></li>
    <li role="presentation" id="medMarijuana" onclick="handleTabClick(this);"><a href="#">I-marijuana</a></li>
    <li role="presentation" id="antiTrapping" onclick="handleTabClick(this);"><a href="#">I-trapping</a></li>
    <li role="presentation" id="gcCommission" onclick="handleTabClick(this);"><a href="#">Gallatin County Commission</a></li>
    <li role="presentation" id="lawCenter" onclick="handleTabClick(this);"><a href="#">L&amp;J Bond</a></li>
  </ul>
  <div id="viz-container">
    <div id="chart1" class="chart-container"></div>
    <div id="chart2" class="chart-container"></div>
    <div id="chart3" class="chart-container"></div>
    <div id="chart4" class="chart-container"></div>
  </div>


  <script src="js/d3.min.js"></script>
  <script src="js/jquery-3.1.1.min.js"></script>

  <script src="js/data-wrangling.js"></script>
  <script src="js/globals.js"></script>
  <script src="js/Dashboard.js"></script>
  <script src="js/Panel.js"></script>

  <script src="js/Choropleth.js"></script>
  <script src="js/CircleShadeMap.js"></script>
  <script src="js/BarGraph.js"></script>
  <script src="js/OpposingBarGraph.js"></script>
  <script src="js/DistrictArray.js"></script>
  <script src="js/Cartogram.js"></script>
  <script src="js/ColorMap.js"></script>
  <script src="js/Text.js"></script>
  <script type="text/javascript">

  var main = function(){
    // Main function, called at bottom of file here
  }

  var renderPane = function(paneId){
    // clear contents of chart-container divs and render pane with given id
    $('.chart-container').empty();
    dashboard.render(panels[paneId]);
  }

  var handleTabClick = function(e){
    // Adjust tab bar classses
    $(e).addClass('active');
    $(e).siblings().removeClass('active');
    renderPane(e.id);
  }

  var dataFiles = [
    // Array of files for Dashboard to pull in
    // Geodata
    {'name': 'mtSenDistricts', 'file': './../geodata/mt_senate_districts.geojson', 'loader': d3.json},
    {'name': 'mtHouseDistricts', 'file': './../geodata/mt_house_districts.geojson', 'loader': d3.json},
    {'name': 'mtCounties', 'file': './../geodata/mt_counties.geojson', 'loader': d3.json},
    // Add: Senate cartogram
    // Add: House cartogram
    // Add: Gallatin County precincts

    // Other data
    {'name': 'mtSenData', 'file': './../data/mt-senate.csv', 'loader': d3.csv},
    {'name': 'mtHouseData', 'file': './../data/mt-house.csv', 'loader': d3.csv},
  ];
  var dataJoins = [
    // Array of data processing functions for Dashboard to run on data refresh
    // TODO: Figure out how to make this more concise?
    {
      'name': 'mtSenDistSenate',
      'functName': bindToGeoJson,
      'geoData': 'mtSenDistricts', 'joinData': 'mtSenData',
      'geoKey': 'number', 'joinKey': 'number',
      'includeCols': ['district', 'incum_party', 'district_label']
    },{
      'name': 'mtHouseDistHouse',
      'functName': bindToGeoJson,
      'geoData': 'mtHouseDistricts', 'joinData': 'mtHouseData',
      'geoKey': 'number', 'joinKey': 'number',
      'includeCols': ['district', 'incum_party', 'district_label']
    }
  ];
  // var initialPanel = {
  //   'name': 'panel1',
  //   'design': [
  //     {'id': 'chart1', 'Template': ColorMap, 'dataVar': 'mtSenDistSenate' },
  //     {'id': 'chart2', 'Template': Text, 'dataVar': 'mtHouseDistHouse' },
  //     {'id': 'chart3', 'Template': Text, 'dataVar': 'mtHouseDistHouse' }
  //   ]
  // };

  /* each panel object essentially gives Dashboard.js >> Panel.js a list of components to render
  'id' is the id for the anchor the component will attach to
  'Template' refers to the component class used to create the chart (or text element)
  'dataVar' is a string used to reference data stored in Dashboard.data. It should match the name of of either a directly loaded data file in dataFiles above, or a name in dataJoins
  'data' (alternative) is a way to pass data directly into the component via props.data (may not work currently)

  */

  var panels = {
    'mtGov': {
      'name': 'mtGov',
      'design': [
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties' },
        // {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCartoGov' }
      ]
    },
    'usHouse': {
      'name': 'usHouse',
      'design': [
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties' },
        // {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCartoUsHouse' }
      ]
    },
    'usPresident': {
      'name': 'usPresident',
      'design': [
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties' },,
        // {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCartoUsPres' }
      ]
    },
    'mtSenate': {
      'name': 'mtSenate',
      'design': [
        // MT Senate control
        {'id': 'chart1', 'Template': ColorMap, 'dataVar': 'mtSenDistSenate' },
        // {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties' }
      ]
    },
    'mtHouse': {
      'name': 'mtHouse',
      'design': [
        // MT house control
        {'id': 'chart1', 'Template': ColorMap, 'dataVar': 'mtHouseDistHouse' },
        // {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtHouseCartoHouse' }
        // Add table
      ]
    },
    'medMarijuana': {
      'name': 'medMarijuana',
      'design': [
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties' },,
        // {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCartoMarij' }
      ]
    },
    'antiTrapping': {
      'name': 'antiTrapping',
      'design': [
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties' },,
        // {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCartoTrapping' }
        // Tabulated
      ]
    },
    // 'gcCommission': {
    //   'name': 'gcCommission',
    //   'design': [
    //     {'id': 'chart1', 'Template': ColorMap, 'dataVar': 'gcPrecinctCommish' },
    //     // Tabulated
    //   ]
    // },
    // 'lawCenter': {
    //   'name': 'lawCenter',
    //   'design': [
    //     {'id': 'chart1', 'Template': ColorMap, 'dataVar': 'gcPrecinctLaw' },
    //     {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'bznPrecinctLaw' }
    //     // Tabluated
    //   ]
    // }
  }

  var dashboard = new Dashboard(dataFiles, dataJoins, panels.mtGov);

  main();

    // // Queue up multiple data files to load
    // d3.queue()
    //   // Geodata
    //   .defer(d3.json, './../geodata/mt_counties.geojson')
    //   .defer(d3.json, './../geodata/gc_precincts.geojson')
    //   .defer(d3.json, './../geodata/mt_senate_districts.geojson')
    //   .defer(d3.json, './../geodata/mt_house_districts.geojson')
    //   .defer(d3.json, './../geodata/sen-carto.geojson')
    //   // Other data
    //   .defer(d3.json, './../data/2012_election_county_data.json')
    //   .defer(d3.json, './../data/fake_election_precincts.json')
    //   .defer(d3.json, './../data/districts.json')
    //   .defer(d3.csv, './../data/mt-senate.csv')
    //   .defer(d3.csv, './../data/mt-house.csv')
    //   .await(main);

    // function main (error,
    //   // Geodata
    //   counties, gcPrecincts, mtSenDistricts, mtHouseDistricts, mtSenCartoDisplay,
    //   // Other data
    //   countyVotes, precinctVotes, districts, mtSenData, mtHouseData
    //   ) {

      // var comboData = bindToGeoJson(mtSenDistricts, mtSenData, 'number', 'number', ['district', 'incum_party', 'district_label']);
      // var comboData2 = bindToGeoJson(mtHouseDistricts, mtHouseData, 'number', 'number', ['district', 'incum_party', 'district_label']);
      // Panel(
      //   [
      //     {'id': 'senateMap', 'Template': ColorMap, 'data': comboData },
      //     {'id': 'senateMap2', 'Template': ColorMap, 'data': comboData2 }
      //   ]
      // );

      // var cartogram = new ColorMap({
      //   'element': document.querySelector('#chart1'),
      //   'data': bindToGeoJson(mtSenCartoDisplay, mtSenData, 'sd', 'number',
      //       ['district', 'incum_party', 'district_label']),
      //   'aspectRatio': .6, // h / w
      // });

      // var senateMap = new ColorMap({
      //   'element': document.querySelector('#chart1'),
      //   'data': bindToGeoJson(mtSenDistricts, mtSenData, 'number', 'number',
      //       ['district', 'incum_party', 'district_label']),
      //   'aspectRatio': .6
      // })

      // var houseMap = new ColorMap({
      //   'element': document.querySelector('#chart3'),
      //   'data': bindToGeoJson(mtHouseDistricts, mtHouseData, 'number', 'number',
      //       ['district', 'incum_party', 'district_label']),
      //   'aspectRatio': .6
      // })

      // var districts = new DistrictArray({
      //   'element': document.querySelector('#chart4'),
      //   'data': districts,
      //   'height': 1500
      // });

      // var countyBar = new BarGraph({
      //   'element': document.querySelector('#chart1'),
      //   'data': prepForBar(countyVotes, 'reg_voters', ['tester_votes', 'rehberg_votes','cox_votes']),
      //   'height': 100
      // })
      // var countyOpposing = new OpposingBarGraph({
      //   'element': document.querySelector('#chart2'),
      //   'data': prepForBar(countyVotes, 'reg_voters', ['tester_votes', 'rehberg_votes','cox_votes']),
      //   'height': 100
      // })

      // var countiesMerged = mergeData(counties, countyVotes, 'NAME', {
      //   'voters': 'reg_voters',
      //   'votesCast': 'votes_cast',
      //   'toPlot': 'tester_votes'
      // });
      // var countyMap = new Choropleth({
      //     'element': document.querySelector('#chart3'),
      //     'data': countiesMerged,
      //     'height': 400
      //   });

      // var precinctsMerged = mergeData(gcPrecincts, precinctVotes, 'PRECINCT', {
      //   'voters': 'VOTERS',
      //   'votesCast': 'VOTERS',
      //   'toPlot': 'A_VOTES'
      // })
      // var gcPrecinctsMap = new Choropleth({
      //     'element': document.querySelector('#chart2'),
      //     'data': precinctsMerged,
      //     'height': 400
      //   });

      // OLD -------
      // var map = new CircleShadeMap({
      //     'element': '#circleshade',
      //     'data': {
      //       'districts': counties,
      //       'votes': countyVotes
      //     },
      //     'width': 500,
      //     'height': 400
      //   }, globals);

    //   // For resizing
    //   d3.select(window).on('resize', function(){
    //   })
    // }
  </script>
</html>