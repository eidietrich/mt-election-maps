<!DOCTYPE html>
<html>
<head>
  <title>Mapping Montana's politics</title>
  <link rel="stylesheet" type="text/css" href="./../css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="./../css/main.css">
</head>
<body>
  <ul class="nav nav-tabs"">
    <li role="presentation" id="home" onclick="handleTabClick(this);" class="active"><a href="#">Overview</a></li>
    <li role="presentation" id="mtGov" onclick="handleTabClick(this);"><a href="#">Montana Governor</a></li>
    <li role="presentation" id="usRep" onclick="handleTabClick(this);"><a href="#">US Rep</a></li>
    <li role="presentation" id="usPresident" onclick="handleTabClick(this);"><a href="#">US Presidency</a></li>
    <li role="presentation" id="mtSenate" onclick="handleTabClick(this);"><a href="#">Montana Senate</a></li>
    <li role="presentation" id="mtHouse" onclick="handleTabClick(this);"><a href="#">Montana House</a></li>
    <li role="presentation" id="medMarijuana" onclick="handleTabClick(this);"><a href="#">I-182</a></li>
    <li role="presentation" id="antiTrapping" onclick="handleTabClick(this);"><a href="#">I-777</a></li>
  </ul>
  <div id="viz-container">
    <div id="refresh-container"></div>
    <div id="chart1" class="chart-container"></div>
    <div id="chart2" class="chart-container"></div>
    <div id="chart3" class="chart-container"></div>
    <div id="chart4" class="chart-container"></div>
    <div id="chart5" class="chart-container"></div>
  </div>

  <!-- Libraries -->
  <script src="js/d3.min.js"></script>
  <script src="js/jquery-3.1.1.min.js"></script>

  <!-- Interface scripts -->
  <script src="js/data-wrangling.js"></script>
  <script src="js/globals.js"></script>
  <script src="js/Dashboard.js"></script>
  <script src="js/Panel.js"></script>

  <!-- Component scripts -->
  <script src="js/BarGraph.js"></script>
  <!-- <script src="js/OpposingBarGraph.js"></script> -->
  <script src="js/ColorMap.js"></script>
  <script src="js/ColorMapByDistrict.js"></script>
  <script src="js/Text.js"></script>
  <script src="js/TableByCounty.js"></script>
   <script src="js/TableByDistrict.js"></script>


  <script type="text/javascript">

  var main = function(){
    // Main function, called at bottom of file here
    dashboard = new Dashboard(dataFiles, dataJoins, testPanel);

    // dashboard = new Dashboard(dataFiles, dataJoins, panels['home']);
  }

  var renderPane = function(paneId){
    // clear contents of chart-container divs and render pane with given id
    $('.chart-container').empty();
    dashboard.currentPanel = panels[paneId];
    dashboard.render(dashboard.currentPanel);
  }

  var handleTabClick = function(e){
    // Adjust tab bar classses
    $(e).addClass('active');
    $(e).siblings().removeClass('active');
    renderPane(e.id);
  }

  var dashboard;

  // Array of files for Dashboard to pull in
  var dataFiles = [
    // Geodata
    {'name': 'mtSenDistricts', 'file': './../geodata/mt_senate_districts.geojson', 'loader': d3.json},
    {'name': 'mtHouseDistricts', 'file': './../geodata/mt_house_districts.geojson', 'loader': d3.json},
    {'name': 'mtCounties', 'file': './../geodata/mt_counties.geojson', 'loader': d3.json},
    // Add: Senate cartogram
    // Add: House cartogram

    // Static data
    {'name': 'mtSen', 'file': './../data/mt-senate.csv', 'loader': d3.csv},
    {'name': 'mtHouse', 'file': './../data/mt-house.csv', 'loader': d3.csv},

    // Live data
    // TODO: Switch this from test data
    {'name': 'races', 'file': './test/livedata-byrace-fullvotes.json', 'loader': d3.json},
    {'name': 'counties', 'file': './test/livedata-bycounty-somevotes.json', 'loader': d3.json},

  ];
  var dataJoins = [
    // Array of data processing functions for Dashboard to run on data refresh
    // See data-wrangling.js for function documentation
    {
      // Should add race-keyed results entries to geoJson properties field
      'name': 'mtResultsByCounty',
      'functName': mergeResultsByCounty,
      'geoData': 'mtCounties', 'joinData': 'counties',
      'otherArgs': [['mtGov','usPresident','usRep','antiTrapping','medMarijuana']]
    },
    {
      'name': 'mtGovResults',
      'functName': summarizeRace,
      'geoData': null, 'joinData': 'races',
      'otherArgs': ['mtGov']
    },
    {
      'name': 'usRepResults',
      'functName': summarizeRace,
      'geoData': null, 'joinData': 'races',
      'otherArgs': ['usRep']
    },
    {
      'name': 'usPresResults',
      'functName': summarizeRace,
      'geoData': null, 'joinData': 'races',
      'otherArgs': ['usPresident']
    },
    {
      'name': 'antiTrappingResults',
      'functName': summarizeRace,
      'geoData': null, 'joinData': 'races',
      'otherArgs': ['antiTrapping']
    },
    {
      'name': 'medMarijuanaResults',
      'functName': summarizeRace,
      'geoData': null, 'joinData': 'races',
      'otherArgs': ['medMarijuana']
    },
    {
      'name': 'mtSenMerged',
      'functName': mergeLegData,
      'geoData': 'mtSenDistricts', 'joinData': 'mtSen',
      'otherArgs': null
    },
    {
      'name': 'mtSenResults',
      'functName': summarizeLegRaces,
      'geoData': 'mtSenMerged', 'joinData': 'races',
      'otherArgs': ['mtSen']
    },
    {
      'name': 'mtHouseMerged',
      'functName': mergeLegData,
      'geoData': 'mtHouseDistricts', 'joinData': 'mtHouse',
      'otherArgs': null
    },
    {
      'name': 'mtHouseResults',
      'functName': summarizeLegRaces,
      'geoData': 'mtHouseMerged', 'joinData': 'races',
      'otherArgs': ['mtHouse']
    },
  ];
  var testPanel = {
    'name': 'test panel',
    'design': [
      {'id': 'chart1', 'Template': ColorMapByDistrict, 'dataVar': 'mtSenResults',
        'props': {
          'aspectRatio': 0.6,
          // 'colorBy': function(d) { return globals.colorByParty(d.properties.incum_party) },
          // 'featureLabel': function(d) { return d.properties.district; },
          }
        },
    ]
  };

  /*

  Each panel object gives Dashboard.js >> Panel.js a list of components to render
  'id' is the id for the anchor the component will attach to
  'Template' refers to the component class used to create the chart (or text element)
  'dataVar' is a string used to reference data stored in Dashboard.data. It should match the name of of either a directly loaded data file in dataFiles above, or a name in dataJoins
  'data' (optional) is a way to pass data directly into the component via props.data (may not work currently)
  'props' object hands the Template constructor additional properties

  */

  var panels = {
    'home': {
      'name': 'home',
      'design': [
        {'id': 'chart1', 'Template': BarGraph, 'dataVar': 'mtGovResults',
          'props': {
            'height': 200,
            'title': "Montana Governor vote",
            'cutline': "This is a cutline",
          }
        },
        {'id': 'chart2', 'Template': BarGraph, 'dataVar': 'usRepResults',
          'props': {
            'height': 200,
            'title': "US House of Representatives vote",
            'cutline': "This is a cutline",
          }
        },
        {'id': 'chart3', 'Template': BarGraph, 'dataVar': 'usPresResults',
          'props': {
            'height': 200,
            'title': "Montana Presidential vote",
            'cutline': "This is a cutline",
          }
        },
      ]
    },
    'mtGov': {
      'name': 'mtGov',
      'design': [
        {'id': 'chart1', 'Template': BarGraph, 'dataVar': 'mtGovResults',
          'props': {
            'height': 150,
            'title': "Title here",
            'cutline': "This is a cutline",
          }
        },
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtResultsByCounty',
          'props': {
            'aspectRatio': 0.6,
            'colorBy': function(d) { return 'green'; },
            'title': "Title here",
            'cutline': "This is a cutline",
          }
        },
        {'id': 'chart3', 'Template': TableByCounty, 'dataVar': 'mtResultsByCounty',
          'props': {
            'race': 'mtGov',
            'title': "Title here",
            'cutline': "This is a cutline"
          }
        },
      ]
    },
    'usRep': {
      'name': 'usRep',
      'design': [
        {'id': 'chart1', 'Template': BarGraph, 'dataVar': 'usRepResults',
          'props': {
            'height': 150,
            'title': "US House of Representatives vote",
            'cutline': "This is a cutline",
          }
        },
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties',
        'props': {
          'aspectRatio': 0.6,
        } },
        {'id': 'chart3', 'Template': TableByCounty, 'dataVar': 'mtResultsByCounty',
        'props': {
          'race': 'usRep',
          'extraCandidateInfo': extraCandidateInfo['usRep'],
          'title': "Title here",
          'cutline': "This is a cutline"
        } },
      ]
    },
    'usPresident': {
      'name': 'usPresident',
      'design': [
        {'id': 'chart1', 'Template': BarGraph, 'dataVar': 'usPresResults',
          'props': {
            'height': 200,
            'title': "Montana Presidential vote",
            'cutline': "This is a cutline",
          }
        },
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties',
        'props': {
          'aspectRatio': 0.6,
        } },
        {'id': 'chart3', 'Template': TableByCounty, 'dataVar': 'mtResultsByCounty',
        'props': {
          'race': 'usPresident',
          'extraCandidateInfo': extraCandidateInfo['usPresident'],
          'title': "Title here",
          'cutline': "This is a cutline"
        } },
      ]
    },
    'mtSenate': {
      'name': 'mtSenate',
      'design': [
        // ADD MT Senate control
        {'id': 'chart2', 'Template': ColorMapByDistrict, 'dataVar': 'mtSenResults',
        'props': {
          'aspectRatio': 0.6,
          // 'colorBy': function(d) { return globals.colorByParty(d.properties.incum_party) },
          // 'featureLabel': function(d) { return d.properties.district; },
          }
        },
        {'id': 'chart3', 'Template': TableByDistrict, 'dataVar': 'mtSenResults',
          'props': {
            'title': "District table",
            'cutline': "This is a cutline"
          }
        },
      ]
    },
    'mtHouse': {
      'name': 'mtHouse',
      'design': [
        // MT house control
        {'id': 'chart2', 'Template': ColorMapByDistrict, 'dataVar': 'mtHouseResults',
        'props': {
          'aspectRatio': 0.6,
          // 'colorBy': function(d) { return globals.colorByParty(d.properties.incum_party) },
          // 'featureLabel': function(d) { return d.properties.district; },
          }
        },
        {'id': 'chart3', 'Template': TableByDistrict, 'dataVar': 'mtHouseResults',
          'props': {
            'title': "District table",
            'cutline': "This is a cutline"
          }
        },
      ]
    },
    'medMarijuana': {
      'name': 'medMarijuana',
      'design': [
        {'id': 'chart1', 'Template': BarGraph, 'dataVar': 'medMarijuanaResults',
          'props': {
            'height': 100,
            'title': "Title here",
            'cutline': "This is a cutline",
          }
        },
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties',
         'props': {
          'aspectRatio': 0.6,
          }
        },
        {'id': 'chart3', 'Template': TableByCounty, 'dataVar': 'mtResultsByCounty',
          'props': {
            'race': 'medMarijuana',
            'extraCandidateInfo': {},
            'title': "Title here",
            'cutline': "This is a cutline"
          }
        },
      ]
    },
    'antiTrapping': {
      'name': 'antiTrapping',
      'design': [
        {'id': 'chart1', 'Template': BarGraph, 'dataVar': 'antiTrappingResults',
          'props': {
            'height': 100,
            'title': "Title here",
            'cutline': "This is a cutline",
          }
        },
        {'id': 'chart2', 'Template': ColorMap, 'dataVar': 'mtCounties',
         'props': {
          'aspectRatio': 0.6,
          'title': "Votes by county",
          'cutline': ""
          }
        },
        {'id': 'chart3', 'Template': TableByCounty, 'dataVar': 'mtResultsByCounty',
          'props': {
            'race': 'antiTrapping',
            'extraCandidateInfo': {},
            'title': "",
            'cutline': ""
          }
        },
      ]
    }
  }

  main();
  </script>
</html>